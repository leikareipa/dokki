<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/vue@3.1.1/dist/vue.global.js"></script>
        <script src="https://unpkg.com/vuex@4.0.0/dist/vuex.global.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/dom-to-image@2.6.0/dist/dom-to-image.min.js"></script>
        
        <style>
            :root
            {
                --dokkiCSS-document-horizontal-left-start: 0px !important;
                --dokkiCSS-topic-horizontal-padding: 20px !important;
            }

            body
            {
                font-family: sans-serif;
                background-color: white;
            }

            #test-container
            {
                position: relative;
                line-height: 1.5;
                background-color: var(--dokkiCSS-page-primary-bg-color);
                width: 440px;
            }

            .component-container
            {
                background-color: var(--dokkiCSS-page-primary-bg-color);
                color: var(--dokkiCSS-page-primary-fg-color);
                position: relative;
                padding: 15px;
            }

            .component-container > *
            {
                margin: 0;
            }

            .dokki-header
            {
                position: relative !important;
            }

            .dokkiCSS-header-container
            {
                margin-left: 10px !important;
                margin-right: 10px !important;
            }
        </style>
    </head>
    <body>
        <div id="test-container"
             class="dokkiCSS-document-container">
        </div>

        <template id="tests-template">
            <dokki-header title="dokki render test"
                          product-name="product: dokki render test"
                          product-version="version: 1.1">
            </dokki-header>

            <product-name>
            </product-name>

            <dokki-tip>
                Lorem ipsum
            </dokki-tip>

            <dokki-tip>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-tip>

            <dokki-warning>
                Lorem ipsum
            </dokki-warning>

            <dokki-warning>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-warning>

            <dokki-image>
            </dokki-image>

            <dokki-image src="//upload.wikimedia.org/wikipedia/commons/thumb/a/ab/William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg/64px-William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg">
            </dokki-image>

            <dokki-image src="//upload.wikimedia.org/wikipedia/commons/thumb/a/ab/William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg/64px-William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg">
                <template #caption>
                    Lorem ipsum
                </template>
            </dokki-image>

            <dokki-image expanded src="//upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Mature_flower_diagram.svg/128px-Mature_flower_diagram.svg.png">
            </dokki-image>

            <dokki-image expanded src="//upload.wikimedia.org/wikipedia/commons/thumb/a/ab/William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg/64px-William_Merritt_Chase_-_Seaside_Flowers%2C_1890s.jpg">
                <template #caption>
                    Lorem ipsum
                </template>
            </dokki-image>

            <dokki-video>
            </dokki-video>

            <dokki-video platform="youtube" src="ZgWGmggi5Xo">
                <template #caption>
                    Lorem ipsum
                </template>
            </dokki-video>

            <dokki-iframe>
            </dokki-iframe>

            <dokki-iframe title="Lorem ipsum">
            </dokki-iframe>

            <dokki-iframe title="Lorem ipsum" expanded height="100px">
            </dokki-iframe>

            <dokki-iframe title="Lorem ipsum" expanded height="200px">
            </dokki-iframe>

            <dokki-console>
            </dokki-console>

            <dokki-console platform="unix">
            </dokki-console>

            <dokki-console platform="windows">
            </dokki-console>

            <dokki-console command="Lorem ipsum">
            </dokki-console>

            <dokki-console command="Lorem ipsum">
                <template #output>
                    <pre>
                        Line 1
                        Line  2


                        Line     5

                        Line       7
                    </pre>
                </template>
            </dokki-console>

            <dokki-console headerless command="Lorem ipsum">
                <template #output>
                    <pre>
                        Line 1
                        Line  2


                        Line     5

                        Line       7
                    </pre>
                </template>
            </dokki-console>

            <dokki-output>
            </dokki-output>

            <dokki-output title="Lorem ipsum">
            </dokki-output>

            <dokki-output expanded>
            </dokki-output>

            <dokki-output expanded>
                Lorem ipsum
            </dokki-output>

            <dokki-output>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-output>

            <dokki-output expanded>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-output>

            <dokki-output expanded>
                Lorem ipsum
                <dokki-output expanded>
                    Lorem ipsum
                    <dokki-output expanded>
                        Lorem ipsum
                    </dokki-output>
                </dokki-output>
            </dokki-output>

            <dokki-output expanded>
                <p>Lorem ipsum</p>
                <dokki-output expanded>
                    <p>Lorem ipsum</p>
                    <dokki-output expanded>
                        <p>Lorem ipsum</p>
                    </dokki-output>
                </dokki-output>
            </dokki-output>

            <dokki-spoiler>
            </dokki-spoiler>

            <dokki-spoiler title="Lorem ipsum">
            </dokki-spoiler>

            <dokki-spoiler expanded>
            </dokki-spoiler>

            <dokki-spoiler expanded>
                Lorem ipsum
            </dokki-spoiler>

            <dokki-spoiler>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-spoiler>

            <dokki-spoiler expanded>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-spoiler>

            <dokki-code>
                <template #code>
                    <pre>
                        Line 1
                        Line  2


                        Line     5

                        Line       7
                    </pre>
                </template>
            </dokki-code>

            <dokki-code code="
                        Line 1
                        Line  2


                        Line     5

                        Line       7
                        ">
            </dokki-code>

            <dokki-code headerless>
                <template #code>
                    <pre>
                        Line 1
                        Line  2


                        Line     5

                        Line       7
                    </pre>
                </template>
            </dokki-code>

            <dokki-code title="HTML"
                                code="
                                <i class='fas fa-fw fa-hammer'></i>
                                <i class='fas fa-fw fa-screwdriver'></i>
                                <i class='fas fa-fw fa-wrench'></i>
                                ">

                <dokki-output expanded>
                    <i class="fas fa-fw fa-hammer"></i>
                    <i class="fas fa-fw fa-screwdriver"></i>
                    <i class="fas fa-fw fa-wrench"></i>
                </dokki-output>

            </dokki-code>

            <dokki-code>
                <template #code>
                    <pre>
                        Lorem
                        ipsum

                        Lipsum
                    </pre>
                </template>

                <dokki-output>
                    Lorem ipsum Lipsum
                </dokki-output>
            </dokki-code>

            <dokki-code>
                <template #code>
                    <pre>
                        Lorem
                        ipsum

                        Lipsum
                    </pre>
                </template>

                <dokki-output title="Lorem ipsum">
                    Lorem ipsum Lipsum
                </dokki-output>
            </dokki-code>

            <dokki-code>
                <template #code>
                    <pre>
                        Lorem
                        ipsum

                        Lipsum
                    </pre>
                </template>

                <dokki-output expanded>
                    Lorem ipsum Lipsum
                </dokki-output>
            </dokki-code>

            <dokki-code>
                <template #code>
                    <pre>
                        Lorem
                        ipsum

                        Lipsum
                    </pre>
                </template>

                <dokki-output expanded title="Lorem ipsum">
                    Lorem ipsum Lipsum
                </dokki-output>
            </dokki-code>

            <dokki-table>
                <template #table>
                    <table>
                        <tr>
                            <th>Lorem</th>
                            <th>Ipsum</th>
                        </tr>
                        <tr>
                            <td>Ipsum</td>
                            <td>Lorem</td>
                        </tr>
                    </table>
                </template>
            </dokki-table>

            <dokki-table>
                <template #caption>
                    Lorem ipsum
                </template>

                <template #table>
                    <table>
                        <tr>
                            <th>Lorem</th>
                            <th>Ipsum</th>
                        </tr>
                        <tr>
                            <td>Ipsum</td>
                            <td>Lorem</td>
                        </tr>
                    </table>
                </template>
            </dokki-table>

            <dokki-table expanded>
                <template #table>
                    <table>
                        <tr>
                            <th>Lorem</th>
                            <th>Ipsum</th>
                        </tr>
                        <tr>
                            <td>Ipsum</td>
                            <td>Lorem</td>
                        </tr>
                    </table>
                </template>
            </dokki-table>

            <dokki-table expanded>
                <template #caption>
                    Lorem ipsum
                </template>

                <template #table>
                    <table>
                        <tr>
                            <th>Lorem</th>
                            <th>Ipsum</th>
                        </tr>
                        <tr>
                            <td>Ipsum</td>
                            <td>Lorem</td>
                        </tr>
                    </table>
                </template>
            </dokki-table>

            <dokki-topic title="Lorem ipsum">
                Ipsum lorem
                <p>Ipsum lorem</p>

                <dokki-subtopic title="Lorem ipsum">
                    Ipsum lorem
                    <p>Ipsum lorem</p>
                </dokki-subtopic>

                <dokki-item title="Lorem ipsum">
                    Ipsum lorem
                    <p>Ipsum lorem</p>
                </dokki-item>
            </dokki-topic>

            <dokki-lorem>
            </dokki-lorem>

            <dokki-lorem>
            </dokki-lorem>

            <dokki-area>
            </dokki-area>

            <dokki-area>
                Lorem ipsum
            </dokki-area>

            <dokki-area>
                <p>Lorem ipsum</p>
                <p>Ipsum lorem</p>
                <p>Lorem ipsum</p>
            </dokki-area>

            <dokki-topic title="Lorem">
                <dokki-lorem>
                </dokki-lorem>

                <dokki-tip>
                    Lorem ipsum
                </dokki-tip>

                <dokki-lorem>
                </dokki-lorem>

                <dokki-lorem>
                </dokki-lorem>

                <dokki-output>
                </dokki-output>

                <dokki-iframe>
                </dokki-iframe>

                <dokki-lorem>
                </dokki-lorem>
            </dokki-topic>
        </template>

        <script>
            const dokkiContainer = document.querySelector("#test-container");
        </script>

        <script>
            const dokkiPath = (new URLSearchParams(window.location.search).get("dokki-path") || "./");

            const dokkiCode = document.createElement("script");
            dokkiCode.src = `${dokkiPath}/dokki.dev.js`;
            dokkiCode.async = false;
            dokkiCode.defer = true;

            const dokkiCSS = document.createElement("link");
            dokkiCSS.rel = "stylesheet";
            dokkiCSS.href = `${dokkiPath}/dokki.css`;
            
            document.head.appendChild(dokkiCSS);
            document.head.appendChild(dokkiCode);
        </script>

        <script>
            const dokkiTheme = (new URLSearchParams(window.location.search).get("theme") || "light");
            dokkiContainer.dataset.dokkiTheme = dokkiTheme;
        </script>
        
        <script>
            window.addEventListener("load", (event)=>
            {
                dokki.start({
                    container: dokkiContainer
                });

                /// Temporary hack - wait for Vue to initialize and all assets (e.g. images)
                /// that were in Vue templates to load in as well. But there really needs to
                /// be a better, more reliable, less hacky way.
                setTimeout(()=>
                {
                    send_message_to_parent("dokkiEV-renderer-ready");
                }, 5000);
            });

            window.document.addEventListener("dokkiEV-start-rendering", async(event)=>
            {
                const result = await render_test_images();
                send_message_to_parent("dokkiEV-rendering-finished", {result});
            });

            function send_message_to_parent(eventId = "", data = {})
            {
                const message = new CustomEvent(eventId, {detail: data})
                window.parent.document.dispatchEvent(message);

                return;
            }
        </script>

        <script>
            const template = document.querySelector("#tests-template");
            const components = Array.from(template.content.children);
            const componentNames = components.map(c=>c.nodeName.toLowerCase());

            mount_test_template();

            function mount_test_template()
            {
                const dstContainer = document.querySelector("#test-container");

                // Mount all components into the test container. Note: We put each component
                // into its own padded container to make sure the image we'll produce of the
                // component won't exclude drop shadows.
                for (const component of components)
                {
                    const componentClone = component.cloneNode(true);
                    const componentContainer = document.createElement("div");

                    componentContainer.classList.add("component-container");
                    componentContainer.appendChild(componentClone);
                    dstContainer.appendChild(componentContainer);
                }

                template.remove();
            }

            async function render_test_images()
            {
                const srcContainer = document.querySelector("#test-container");
                const mountedComponents = Array.from(srcContainer.children).filter(c=>c.className=="component-container");
                
                return {
                    images: await Promise.all(mountedComponents.map(c=>domtoimage.toPng(c))),
                    names: componentNames
                };
            }
        </script>
    </body>
</html>
